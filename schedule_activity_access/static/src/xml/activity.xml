<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <!-- Override to provide edit access to assign user -->
    <t t-name="mail.activity_thread_message_tools">
        <t t-if="activity.user_id[0] == uid">
            <div t-if="activity.can_write"
                 class="o_thread_message_tools btn-group">
                <span t-if="activity.activity_category !== 'upload_file'"
                      class="o_mark_as_done" data-toggle="popover"
                      t-att-data-activity-id="activity.id"
                      t-att-data-force-next-activity="activity.force_next"
                      t-att-data-previous-activity-type-id="activity.activity_type_id[0]">
                    <a role="button" href="#"
                       class="btn btn-link btn-success text-muted o_activity_link mr8">
                    <i class="fa fa-check"/>
                        Mark Done </a>
                </span>
                <span t-if="activity.activity_category === 'upload_file'"
                      class="o_mark_as_done_upload_file"
                      t-att-data-activity-id="activity.id"
                      t-att-data-force-next-activity="activity.force_next"
                      t-att-data-previous-activity-type-id="activity.activity_type_id[0]"
                      t-att-data-fileupload-id="activity.fileuploadID">
                    <a role="button" href="#"
                       class="btn btn-link btn-success text-muted o_activity_link mr8">
                    <i class="fa fa-upload"/>
                        Upload Document </a>
                </span>
                <span t-if="activity.activity_category === 'upload_file'"
                      class="d-none">
                    <t t-call="HiddenInputFile">
                        <t t-set="fileupload_id"
                           t-value="activity.fileuploadID"/>
                        <t t-set="fileupload_action" t-translation="off">/web/binary/upload_attachment</t>
                        <input type="hidden" name="model"
                               t-att-value="activity.res_model"/>
                        <input type="hidden" name="id"
                               t-att-value="activity.res_id"/>
                    </t>
                </span>
                <a role="button" href="#"
                   class="btn btn-link btn-secondary text-muted o_edit_activity o_activity_link"
                   t-att-data-activity-id="activity.id">
                    <i class="fa fa-pencil"/>
                    Edit
                </a>
                <a role="button" href="#"
                   class="btn btn-link btn-danger text-muted o_unlink_activity o_activity_link"
                   t-att-data-activity-id="activity.id">
                    <i class="fa fa-times"/>
                    Cancel
                </a>
            </div>
        </t>
    </t>

    <!-- Override to provide edit access to assign user in employee calender -->
    <t t-name="mail.activities-list-group-item">
        <li t-attf-class="list-group-item o_log_activity d-flex #{log_last ? 'border-bottom' : ''}"
            role="menuitem">
            <div t-attf-class="o_activity_title o_log_activity #{edit_class}"
                 t-att-data-activity-id="log.id">
                <div t-attf-class="o_activity_title_entry {{! log.force_next ? 'align-items-center' : 'mb-1'}}">
                    <span t-attf-class="fa #{log.icon ? log.icon : 'fa-bell' } fa-fw mr-2 text-center text-muted"
                          role="img" aria-label="Log" title="Log"/>
                    <strong class="text-dark"><t t-esc="log.title_action or log.activity_type_id[1]"/></strong>
                    <t t-if="log.user_id[0] == session.uid">
                        <button t-if="! log.force_next and log.can_write"
                                class="btn btn-sm btn-link py-0 o_edit_button"><i class="fa fa-pencil"/></button>
                    </t>
                </div>
                <div class="o_activity_title_entry mt-1"
                     t-if="log.state != 'today'">
                    <span class="fa fa-clock-o fa-fw mr-2 text-center text-muted"
                          role="img" aria-label="Deadline" title="Deadline"/>
                    <small t-att-title="log.date_deadline"><t t-esc="log.label_delay" /></small>
                </div>
                <t t-if="log.mail_template_ids">
                    <div t-foreach="log.mail_template_ids" t-as="mail_template"
                         class="o_activity_title_entry mt-2"
                         t-att-data-activity-id="log.id"
                         t-att-data-force-next-activity="log.force_next"
                         t-att-data-previous-activity-type-id="log.activity_type_id[0]">
                        <i class="fa fa-envelope-o fa-fw mr-2 text-center text-muted"
                           aria-label="Mail" title="Mail" role="img"></i>
                        <small>
                            <div class="mb-1" t-esc="mail_template.name + ':'"/>
                            <a class="o_activity_template_preview"
                               t-att-data-template-id="mail_template.id" href="#"><b>Preview</b></a>
                            <small>or</small>
                            <a class="o_activity_template_send"
                               t-att-data-template-id="mail_template.id" href="#"><b>Send Now</b></a>
                        </small>
                    </div>
                </t>
                <div t-if="log.user_id[0] != session.uid and log.mail_template_ids"
                     class="o_activity_title_entry">
                    <span class="fa fa-user fa-fw mr-2 text-center text-muted"
                          role="img" aria-label="User" title="User"/>
                    <span><t t-esc="log.user_id[1]" /></span>
                </div>
            </div>
            <div t-if="log.can_write" class="flex-grow-1 text-right">
                <t t-if="log.activity_category === 'upload_file'">
                    <a t-att-data-force-next-activity="log.force_next"
                       t-att-data-previous-activity-type-id="log.activity_type_id[0]"
                       t-att-data-activity-id="log.id"
                       class="o_mark_as_done_upload_file o_activity_link o_activity_link_kanban fa fa-upload"
                       title="Upload file" role="img"
                       t-att-data-fileupload-id="log.fileuploadID"/>
                    <span class="d-none">
                            <t t-call="HiddenInputFile">
                                <t t-set="fileupload_id"
                                   t-value="log.fileuploadID"/>
                                <t t-set="fileupload_action" t-translation="off">/web/binary/upload_attachment</t>
                                <input type="hidden" name="model"
                                       t-att-value="log.res_model"/>
                                <input type="hidden" name="id"
                                       t-att-value="log.res_id"/>
                            </t>
                        </span>
                </t>
                <t t-else="">
                    <t t-if="log.user_id[0] == session.uid">
                        <a t-att-data-force-next-activity="log.force_next"
                           t-att-data-previous-activity-type-id="log.activity_type_id[0]"
                           t-att-data-activity-id="log.id"
                           t-attf-href="#o_mark_done_form{{log.id}}"
                           class="o_mark_as_done o_activity_link o_activity_link_kanban fa fa-check-circle"
                           data-toggle="collapse" title="Mark as done" role="img"
                           aria-label="Mark as done"/>
                    </t>
                </t>
            </div>
        </li>
    </t>

</templates>
